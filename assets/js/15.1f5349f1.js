(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{599:function(s,n,a){"use strict";a.r(n);var e=a(1),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx-安装、配置及优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-安装、配置及优化"}},[s._v("#")]),s._v(" Nginx 安装、配置及优化")]),s._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),a("p",[s._v("​\tNginx是一款自由的、开源的、高性能的HTTP服务器和反向代理服务器；同时也是一个IMAP、POP3、SMTP代理服务器；Nginx可以作为一个HTTP服务器进行网站的发布处理，另外Nginx可以作为反向代理进行负载均衡的实现。Nginx使用基于事件驱动架构，使得其可以支持数以百万级别的TCP连接，高度的模块化和自由软件许可证是的第三方模块层出不穷，Nginx同时也是一个跨平台服务器，可以运行在Linux,Windows,FreeBSD,Solaris, AIX,Mac OS等操作系统上，这些优秀的设计带来的极大的稳定性。具体不多做介绍，网上书上比比皆是。本文仅作个人学习记录。")]),s._v(" "),a("ul",[a("li",[s._v("核心特点：高并发请求的同时保持高效的服务")]),s._v(" "),a("li",[s._v("热部署")]),s._v(" "),a("li",[s._v("低内存消耗")]),s._v(" "),a("li",[s._v("处理响应请求很快")]),s._v(" "),a("li",[s._v("具有很高的可靠性")])]),s._v(" "),a("h2",{attrs:{id:"nginx-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-安装"}},[s._v("#")]),s._v(" Nginx 安装")]),s._v(" "),a("h3",{attrs:{id:"环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),a("ul",[a("li",[s._v("阿里云主机 CentOS 7.3 64Bit")]),s._v(" "),a("li",[s._v("Nginx 1.6.2")])]),s._v(" "),a("p",[s._v("###下载")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget http://nginx.org/download/nginx-1.6.2.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("安装第三方库")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel\nyum -y install pcre-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("安装成功以后可以查看pcre版本： "),a("code",[s._v("pcre-config —version")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://github.com/Aoenu/picture/blob/master/Nginx/WX20190121-164201@2x.png?raw=true",alt:"pcre版本"}})]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("解压安装包")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("tar zxvf nginx-1.6.2.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("从configure脚本自动生成Makefile")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /root/nginx-1.6.2\n./configure --prefix=/usr/local/webserver/nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("这里的 "),a("code",[s._v("—prefix")]),s._v(" 选项是指定Nginx的安装路径，这里我是指定安装到路径："),a("code",[s._v("/usr/local/webserver/nginx")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("编译安装")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /root/nginx-1.6.2\nmake && make install\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[a("strong",[s._v("查看Nginx版本")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/usr/local/webserver/nginx/sbin/nginx -v\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://github.com/Aoenu/picture/blob/master/Nginx/WX20190121-164507@2x.png?raw=true",alt:"Nginx版本"}})]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("查看安装后的目录")])])]),s._v(" "),a("p",[s._v("总共四个目录："),a("code",[s._v("conf")]),s._v("、"),a("code",[s._v("html")]),s._v("、"),a("code",[s._v("logs")]),s._v("、"),a("code",[s._v("sbin")]),s._v("  分别对应Nginx配置、默认网站、日志信息、Nginx命令")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://github.com/Aoenu/picture/blob/master/Nginx/WX20190121-164626@2x.png?raw=true",alt:"安装目录"}})]),s._v(" "),a("p",[s._v("###启动")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/usr/local/webserver/nginx/sbin/nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("浏览器访问Nginx成功（主机80端口被占用，改用81端口）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://github.com/Aoenu/picture/blob/master/Nginx/WX20190121-170640@2x.png?raw=true",alt:"浏览器访问成功"}})]),s._v(" "),a("h3",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("ul",[a("li",[s._v("测试nginx测试文件是否正确")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/usr/local/webserver/nginx/sbin/nginx -t\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("指定配置文件启动")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/usr/local/webserver/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("重启nginx")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/usr/local/webserver/nginx/sbin/nginx -s reload          # 重新载入配置文件\n/usr/local/webserver/nginx/sbin/nginx -s reopen          # 重启 Nginx\nkill -HUP nginx进程号\t\t\t\t\t\t\t\t\t   # kill -HUP nginx进程号\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("停止nginx")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/usr/local/webserver/nginx/sbin/nginx -s stop              # 停止 Nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("查看Nginx进程")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ps -ef | grep nginx                           # 找到master对应的进程号\nkill -TERM nginx进程号\t\t\t\t\t\t\t# 快速停止\nkill -INT nginx进程号\t\t\t\t\t\t\t# 快速停止\nkill -QUIT nginx进程号\t\t\t\t\t\t\t# 从容停止\npkill -9 nginx\t\t\t\t\t\t\t\t  # 强制停止所有\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"开机自启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开机自启"}},[s._v("#")]),s._v(" 开机自启")]),s._v(" "),a("p",[s._v("​\tNginx作为一个web服务器，我们通常希望其随着系统提起来启动，在linux下想要软件随系统一起启动，通常我们会有一个自动启动的脚本文件，我们把启动命令放在脚本文件中即可；不同发行版的linux，这个脚本文件的名称和位置有所不同，这个可以自己百度查询，本次使用的是Centos7.3 ，脚本文件为"),a("code",[s._v("/etc/rc.d/rc.local")]),s._v("，操作如下：")]),s._v(" "),a("div",{staticClass:"language-/usr/local/webserver/nginx/sbin/nginx -s stop              # 停止 Nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vi /etc/rc.d/rc.loacl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://github.com/Aoenu/picture/blob/master/Nginx/WX20190121-172257@2x.png?raw=true",alt:"加入启动命令"}})]),s._v(" "),a("h2",{attrs:{id:"nginx-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[s._v("#")]),s._v(" Nginx 配置")]),s._v(" "),a("p",[s._v("​\tNginx 是一个基于模块化设计的应用，其配置文件也是基于模块化设计的配置文件，Nginx配置文件位于Nginx安装目录下的"),a("code",[s._v("/conf/nginx.conf")])]),s._v(" "),a("h3",{attrs:{id:"nginx配置文件结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置文件结构"}},[s._v("#")]),s._v(" Nginx配置文件结构")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("...              #全局块\n\nevents {         #events块\n   ...\n}\n\nhttp      #http块\n{\n    ...   #http全局块\n    server        #server块\n    { \n        ...       #server全局块\n        location [PATTERN]   #location块\n        {\n            ...\n        }\n        location [PATTERN] \n        {\n            ...\n        }\n    }\n    server\n    {\n      ...\n    }\n    ...     #http全局块\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("全局块：配置影响"),a("code",[s._v("nginx")]),s._v("全局的指令。一般有运行"),a("code",[s._v("nginx")]),s._v("服务器的用户组，"),a("code",[s._v("nginx")]),s._v("进程"),a("code",[s._v("pid")]),s._v("存放路径，日志存放路径，配置文件引入，允许生成"),a("code",[s._v("worker process")]),s._v("数等。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("events")]),s._v("块：配置影响"),a("code",[s._v("nginx")]),s._v("服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("http")]),s._v("块：可以嵌套多个"),a("code",[s._v("server")]),s._v("，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，"),a("code",[s._v("mime-type")]),s._v("定义，日志自定义，是否使用"),a("code",[s._v("sendfile")]),s._v("传输文件，连接超时时间，单连接请求数等。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("server")]),s._v("块：配置虚拟主机的相关参数，一个"),a("code",[s._v("http")]),s._v("中可以有多个"),a("code",[s._v("server")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("location")]),s._v("块：配置请求的路由，以及各种页面的处理情况。")])])]),s._v(" "),a("h3",{attrs:{id:"nginx-默认配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-默认配置文件"}},[s._v("#")]),s._v(" Nginx 默认配置文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    server {\n        listen       80;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n\n        # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n        #\n        #location ~ \\.php$ {\n        #    proxy_pass   http://127.0.0.1;\n        #}\n\n        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n        #\n        #location ~ \\.php$ {\n        #    root           html;\n        #    fastcgi_pass   127.0.0.1:9000;\n        #    fastcgi_index  index.php;\n        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        #    include        fastcgi_params;\n        #}\n\n        # deny access to .htaccess files, if Apache's document root\n        # concurs with nginx's one\n        #\n        #location ~ /\\.ht {\n        #    deny  all;\n        #}\n    }\n\n\n    # another virtual host using mix of IP-, name-, and port-based configuration\n    #\n    #server {\n    #    listen       8000;\n    #    listen       somename:8080;\n    #    server_name  somename  alias  another.alias;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n\n    # HTTPS server\n    #\n    #server {\n    #    listen       443 ssl;\n    #    server_name  localhost;\n\n    #    ssl_certificate      cert.pem;\n    #    ssl_certificate_key  cert.key;\n\n    #    ssl_session_cache    shared:SSL:1m;\n    #    ssl_session_timeout  5m;\n\n    #    ssl_ciphers  HIGH:!aNULL:!MD5;\n    #    ssl_prefer_server_ciphers  on;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br")])]),a("p",[a("code",[s._v("nginx")]),s._v("配置文件主要分成四个部分：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("main")]),s._v("，全局设置，影响其它部分所有设置")]),s._v(" "),a("li",[a("code",[s._v("server")]),s._v("，主机服务相关设置，主要用于指定虚拟主机域名、IP和端口")]),s._v(" "),a("li",[a("code",[s._v("location")]),s._v("，"),a("code",[s._v("URL")]),s._v("匹配特定位置后的设置，反向代理、内容篡改相关设置")]),s._v(" "),a("li",[a("code",[s._v("upstream")]),s._v("，上游服务器设置，负载均衡相关配置")])]),s._v(" "),a("p",[s._v("他们之间的关系是："),a("code",[s._v("server")]),s._v("继承"),a("code",[s._v("main")]),s._v("，"),a("code",[s._v("location")]),s._v("继承"),a("code",[s._v("server")]),s._v("；"),a("code",[s._v("upstream")]),s._v("既不会继承指令也不会被继承。")]),s._v(" "),a("h3",{attrs:{id:"nginx-配置解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置解析"}},[s._v("#")]),s._v(" Nginx 配置解析")]),s._v(" "),a("p",[s._v("如下是一份通用的配置和详解：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#定义 Nginx 运行的用户和用户组,默认由 nobody 账号运行, windows 下面可以注释掉。 \nuser  nobody; \n\n#nginx进程数，建议设置为等于CPU总核心数。可以和worker_cpu_affinity配合\nworker_processes  1; \n\n#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#进程文件，window下可以注释掉\n#pid        logs/nginx.pid;\n\n# 一个nginx进程打开的最多文件描述符(句柄)数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，\n# 但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。\nworker_rlimit_nofile 65535;\n\n#工作模式与连接数上限\nevents {\n    # 参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; \n    # epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。\n   #use epoll;\n   #connections 20000;  # 每个进程允许的最多连接数\n   # 单个进程最大连接数（最大连接数=连接数*进程数）该值受系统进程最大打开文件数限制，需要使用命令ulimit -n 查看当前设置\n   worker_connections 65535;\n}\n\n#设定http服务器\nhttp {\n    #文件扩展名与文件类型映射表\n    #include 是个主模块指令，可以将配置文件拆分并引用，可以减少主配置文件的复杂度\n    include       mime.types;\n    #默认文件类型\n    default_type  application/octet-stream;\n    #charset utf-8; #默认编码\n\n    #定义虚拟主机日志的格式\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n    \n    #定义虚拟主机访问日志\n    #access_log  logs/access.log  main;\n\n    #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。\n    sendfile        on;\n    #autoindex on; #开启目录列表访问，合适下载服务器，默认关闭。\n\n    #防止网络阻塞\n    #tcp_nopush     on;\n\n    #长连接超时时间，单位是秒，默认为0\n    keepalive_timeout  65;\n\n    # gzip压缩功能设置\n    gzip on; #开启gzip压缩输出\n    gzip_min_length 1k; #最小压缩文件大小\n    gzip_buffers    4 16k; #压缩缓冲区\n    gzip_http_version 1.0; #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）\n    gzip_comp_level 6; #压缩等级\n    #压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。\n    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;\n    gzip_vary on; //和http头有关系，加个vary头，给代理服务器用的，有的浏览器支持压缩，有的不支持，所以避免浪费不支持的也压缩，所以根据客户端的HTTP头来判断，是否需要压缩\n    #limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用\n\n    # http_proxy服务全局设置\n    client_max_body_size   10m;\n    client_body_buffer_size   128k;\n    proxy_connect_timeout   75;\n    proxy_send_timeout   75;\n    proxy_read_timeout   75;\n    proxy_buffer_size   4k;\n    proxy_buffers   4 32k;\n    proxy_busy_buffers_size   64k;\n    proxy_temp_file_write_size  64k;\n    proxy_temp_path   /usr/local/nginx/proxy_temp 1 2;\n\n   # 设定负载均衡后台服务器列表 \n    upstream  backend.com  { \n        #ip_hash; # 指定支持的调度算法\n        # upstream 的负载均衡，weight 是权重，可以根据机器配置定义权重。weigth 参数表示权值，权值越高被分配到的几率越大。\n        server   192.168.10.100:8080 max_fails=2 fail_timeout=30s ;  \n        server   192.168.10.101:8080 max_fails=2 fail_timeout=30s ;  \n    }\n\n    #虚拟主机的配置\n    server {\n        #监听端口\n        listen       80;\n        #域名可以有多个，用空格隔开\n        server_name  localhost fontend.com;\n        # Server Side Include，通常称为服务器端嵌入\n        #ssi on;\n        #默认编码\n        #charset utf-8;\n        #定义本虚拟主机的访问日志\n        #access_log  logs/host.access.log  main;\n        \n        # 因为所有的地址都以 / 开头，所以这条规则将匹配到所有请求\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n        \n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n\n       # 图片缓存时间设置\n       location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$ {\n          expires 10d;\n       }\n\n       # JS和CSS缓存时间设置\n       location ~ .*.(js|css)?$ {\n          expires 1h;\n       }\n\n        #代理配置\n        # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n        #location /proxy/ {\n        #    proxy_pass   http://127.0.0.1;\n        #}\n\n        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n        #\n        #location ~ \\.php$ {\n        #    root           html;\n        #    fastcgi_pass   127.0.0.1:9000;\n        #    fastcgi_index  index.php;\n        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        #    include        fastcgi_params;\n        #}\n\n        # deny access to .htaccess files, if Apache's document root\n        # concurs with nginx's one\n        #\n        #location ~ /\\.ht {\n        #    deny  all;\n        #}\n    }\n\n    # another virtual host using mix of IP-, name-, and port-based configuration\n    #\n    #server {\n    #    listen       8000;\n    #    listen       somename:8080;\n    #    server_name  somename  alias  another.alias;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n    # HTTPS server\n    #\n    #server {\n    #    listen       443 ssl;\n    #    server_name  localhost;\n\n    #    ssl_certificate      cert.pem;\n    #    ssl_certificate_key  cert.key;\n\n    #    ssl_session_cache    shared:SSL:1m;\n    #    ssl_session_timeout  5m;\n\n    #    ssl_ciphers  HIGH:!aNULL:!MD5;\n    #    ssl_prefer_server_ciphers  on;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br"),a("span",{staticClass:"line-number"},[s._v("144")]),a("br"),a("span",{staticClass:"line-number"},[s._v("145")]),a("br"),a("span",{staticClass:"line-number"},[s._v("146")]),a("br"),a("span",{staticClass:"line-number"},[s._v("147")]),a("br"),a("span",{staticClass:"line-number"},[s._v("148")]),a("br"),a("span",{staticClass:"line-number"},[s._v("149")]),a("br"),a("span",{staticClass:"line-number"},[s._v("150")]),a("br"),a("span",{staticClass:"line-number"},[s._v("151")]),a("br"),a("span",{staticClass:"line-number"},[s._v("152")]),a("br"),a("span",{staticClass:"line-number"},[s._v("153")]),a("br"),a("span",{staticClass:"line-number"},[s._v("154")]),a("br"),a("span",{staticClass:"line-number"},[s._v("155")]),a("br"),a("span",{staticClass:"line-number"},[s._v("156")]),a("br"),a("span",{staticClass:"line-number"},[s._v("157")]),a("br"),a("span",{staticClass:"line-number"},[s._v("158")]),a("br"),a("span",{staticClass:"line-number"},[s._v("159")]),a("br"),a("span",{staticClass:"line-number"},[s._v("160")]),a("br"),a("span",{staticClass:"line-number"},[s._v("161")]),a("br"),a("span",{staticClass:"line-number"},[s._v("162")]),a("br"),a("span",{staticClass:"line-number"},[s._v("163")]),a("br"),a("span",{staticClass:"line-number"},[s._v("164")]),a("br"),a("span",{staticClass:"line-number"},[s._v("165")]),a("br"),a("span",{staticClass:"line-number"},[s._v("166")]),a("br"),a("span",{staticClass:"line-number"},[s._v("167")]),a("br"),a("span",{staticClass:"line-number"},[s._v("168")]),a("br"),a("span",{staticClass:"line-number"},[s._v("169")]),a("br"),a("span",{staticClass:"line-number"},[s._v("170")]),a("br"),a("span",{staticClass:"line-number"},[s._v("171")]),a("br"),a("span",{staticClass:"line-number"},[s._v("172")]),a("br"),a("span",{staticClass:"line-number"},[s._v("173")]),a("br"),a("span",{staticClass:"line-number"},[s._v("174")]),a("br"),a("span",{staticClass:"line-number"},[s._v("175")]),a("br"),a("span",{staticClass:"line-number"},[s._v("176")]),a("br"),a("span",{staticClass:"line-number"},[s._v("177")]),a("br"),a("span",{staticClass:"line-number"},[s._v("178")]),a("br"),a("span",{staticClass:"line-number"},[s._v("179")]),a("br"),a("span",{staticClass:"line-number"},[s._v("180")]),a("br"),a("span",{staticClass:"line-number"},[s._v("181")]),a("br"),a("span",{staticClass:"line-number"},[s._v("182")]),a("br")])]),a("h3",{attrs:{id:"location匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location匹配"}},[s._v("#")]),s._v(" location匹配")]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location  = / {\n  # 精确匹配 / ，主机名后面不能带任何字符串\n  [ configuration A ] \n}\n\nlocation  / {\n  # 因为所有的地址都以 / 开头，所以这条规则将匹配到所有请求\n  # 但是正则和最长字符串会优先匹配\n  [ configuration B ] \n}\n\nlocation /documents/ {\n  # 匹配任何以 /documents/ 开头的地址，匹配符合以后，还要继续往下搜索\n  # 只有后面的正则表达式没有匹配到时，这一条才会采用这一条\n  [ configuration C ] \n}\n\nlocation ~ /documents/Abc {\n  # 匹配任何以 /documents/ 开头的地址，匹配符合以后，还要继续往下搜索\n  # 只有后面的正则表达式没有匹配到时，这一条才会采用这一条\n  [ configuration CC ] \n}\n\nlocation ^~ /images/ {\n  # 匹配任何以 /images/ 开头的地址，匹配符合以后，停止往下搜索正则，采用这一条。\n  [ configuration D ] \n}\n\nlocation ~* \\.(gif|jpg|jpeg)$ {\n  # 匹配所有以 gif,jpg或jpeg 结尾的请求\n  # 然而，所有请求 /images/ 下的图片会被 config D 处理，因为 ^~ 到达不了这一条正则\n  [ configuration E ] \n}\n\nlocation /images/ {\n  # 字符匹配到 /images/，继续往下，会发现 ^~ 存在\n  [ configuration F ] \n}\n\nlocation /images/abc {\n  # 最长字符匹配到 /images/abc，继续往下，会发现 ^~ 存在\n  # F与G的放置顺序是没有关系的\n  [ configuration G ] \n}\n\nlocation ~ /images/abc/ {\n  # 只有去掉 config D 才有效：先最长匹配 config G 开头的地址，继续往下搜索，匹配到这一条正则，采用\n    [ configuration H ] \n}\n\nlocation ~* /js/.*/\\.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br")])]),a("ul",[a("li",[s._v("以"),a("code",[s._v("=")]),s._v("开头表示精确匹配")]),s._v(" "),a("li",[a("code",[s._v("^~")]),s._v(" 开头表示uri以某个常规字符串开头，不是正则匹配")]),s._v(" "),a("li",[a("code",[s._v("~")]),s._v("开头表示区分大小写的正则匹配;")]),s._v(" "),a("li",[a("code",[s._v("~*")]),s._v(" 开头表示不区分大小写的正则匹配")]),s._v(" "),a("li",[a("code",[s._v("/")]),s._v(" 通用匹配, 如果没有其它匹配,任何请求都会匹配到")])]),s._v(" "),a("p",[s._v("优先级：\n(location =) > (location 完整路径) > (location ^~ 路径) > (location ~,~* 正则顺序) > (location 部分起始路径) > (/)")]),s._v(" "),a("h3",{attrs:{id:"配置反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置反向代理"}},[s._v("#")]),s._v(" 配置反向代理")]),s._v(" "),a("p",[s._v("详解：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 对 “/” 启用反向代理\nlocation / {\n  proxy_pass http://127.0.0.1:3000;  # 设置要代理的 uri，注意最后的 /。可以是 Unix 域套接字路径，也可以是正则表达式。\n  proxy_redirect off; # 设置后端服务器“Location”响应头和“Refresh”响应头的替换文本\n  proxy_set_header X-Real-IP $remote_addr; # 获取用户的真实 IP 地址\n  #后端的Web服务器可以通过 X-Forwarded-For 获取用户真实IP，多个 nginx 反代的情况下，例如 CDN。参见：http://gong1208.iteye.com/blog/1559835 和 http://bbs.linuxtone.org/thread-9050-1-1.html\n  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  #以下是一些反向代理的配置，可选。\n  proxy_set_header Host $host; # 允许重新定义或者添加发往后端服务器的请求头。\n\n  client_max_body_size 10m; #允许客户端请求的最大单文件字节数\n  client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数，\n  proxy_connect_timeout 90; #nginx跟后端服务器连接超时时间(代理连接超时)\n  proxy_send_timeout 90; #后端服务器数据回传时间(代理发送超时)\n  proxy_read_timeout 90; #连接成功后，后端服务器响应时间(代理接收超时)\n  proxy_buffer_size 4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小\n  proxy_buffers 4 32k; #proxy_buffers缓冲区，网页平均在32k以下的设置\n  proxy_busy_buffers_size 64k; #高负荷下缓冲大小（proxy_buffers*2）\n  proxy_temp_file_write_size 64k;\n  #设定缓存文件夹大小，大于这个值，将从upstream服务器传\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("举例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location ^~ /service/ {\n  proxy_pass http://192.168.60.245:8080/;\n  proxy_redirect      default;\n  proxy_set_header    Host $host\n  proxy_set_header    X-Real-IP $remote_addr;\n  proxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("简化：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location /proxy/ {\n  proxy_pass http://backend.com/;\n  proxy_redirect      default;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"配置rewrite"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置rewrite"}},[s._v("#")]),s._v(" 配置rewrite")]),s._v(" "),a("p",[s._v("rewrite功能就是集合正则表达式和标志位实现url重写和重定向。rewrite只能放在server{}、location{}、if(){}块中，并且只能对域名后边的出去传递参数外的字符串起作用。如URL：\n"),a("code",[s._v("http://microloan-sms-platform.yxapp.xyz/proxy/sms/task/querydeleted?page=1&pagesize=10")]),s._v("\n只对/proxy/sms/task/querydeleted进行重写。")]),s._v(" "),a("p",[s._v("如果相对域名或参数字符串起作用，可以使用全局变量匹配，也可以使用proxy_pass反向代理。")]),s._v(" "),a("p",[s._v("表明看rewrite和location功能有点像，都能实现跳转，主要区别在于rewrite是在同一域名内更改获取资源的路径，而location是对一类路径做控制访问或反向代理，可以proxy_pass到其他机器。很多情况下rewrite也会写在location里，它们的执行顺序是：")]),s._v(" "),a("ul",[a("li",[s._v("执行server块的rewrite指令")]),s._v(" "),a("li",[s._v("执行location匹配")]),s._v(" "),a("li",[s._v("执行选定的location中的rewrite指令")])]),s._v(" "),a("p",[s._v("如果其中某步URI被重写，则重新循环执行1-3，直到找到真实存在的文件；循环超过10次，则返回500 Internal Server Error错误。")]),s._v(" "),a("p",[s._v("rewrite规则后边，通常会带有flag标志位：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("last")]),s._v(" : 相当于Apache的[L]标记，表示完成rewrite")]),s._v(" "),a("li",[a("code",[s._v("break")]),s._v(" : 停止执行当前虚拟主机的后续rewrite指令集")]),s._v(" "),a("li",[a("code",[s._v("redirect")]),s._v(" : 返回"),a("code",[s._v("302")]),s._v("临时重定向，地址栏会显示跳转后的地址")]),s._v(" "),a("li",[a("code",[s._v("permanent")]),s._v(" : 返回"),a("code",[s._v("301")]),s._v("永久重定向，地址栏会显示跳转后的地址")])]),s._v(" "),a("p",[a("code",[s._v("last")]),s._v(" 和 "),a("code",[s._v("break")]),s._v(" 区别：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("last")]),s._v("一般写在"),a("code",[s._v("server")]),s._v("和"),a("code",[s._v("if")]),s._v("中，而"),a("code",[s._v("break")]),s._v("一般使用在"),a("code",[s._v("location")]),s._v("中")]),s._v(" "),a("li",[a("code",[s._v("last")]),s._v("不终止重写后的url匹配，即新的url会再从"),a("code",[s._v("server")]),s._v("走一遍匹配流程，而"),a("code",[s._v("break")]),s._v("终止重写后的匹配")]),s._v(" "),a("li",[a("code",[s._v("break")]),s._v("和"),a("code",[s._v("last")]),s._v("都能组织继续执行后面的rewrite指令")])]),s._v(" "),a("p",[s._v("rewrite常用正则：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v(".")]),s._v(" ： 匹配除换行符以外的任意字符")]),s._v(" "),a("li",[a("code",[s._v("?")]),s._v(" ： 重复0次或1次")]),s._v(" "),a("li",[a("code",[s._v("+")]),s._v(" ： 重复1次或更多次")]),s._v(" "),a("li",[a("code",[s._v("*")]),s._v(" ： 重复0次或更多次")]),s._v(" "),a("li",[a("code",[s._v("\\d")]),s._v(" ：匹配数字")]),s._v(" "),a("li",[a("code",[s._v("^")]),s._v(" ： 匹配字符串的开始")]),s._v(" "),a("li",[a("code",[s._v("$")]),s._v(" ： 匹配字符串的介绍")]),s._v(" "),a("li",[a("code",[s._v("{n}")]),s._v(" ： 重复n次")]),s._v(" "),a("li",[a("code",[s._v("{n,}")]),s._v(" ： 重复n次或更多次")]),s._v(" "),a("li",[a("code",[s._v("[c]")]),s._v(" ： 匹配单个字符c")]),s._v(" "),a("li",[a("code",[s._v("[a-z]")]),s._v(" ： 匹配a-z小写字母的任意一个")])]),s._v(" "),a("p",[s._v("可以使用"),a("code",[s._v("()")]),s._v("来进行分组，可以通过"),a("code",[s._v("$1")]),s._v("的形式来引用。")]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("location /proxy/ {\n        proxy_pass http://microloan-notification-web.yxapp.in;\n        rewrite /proxy/(.*)$ /$1 break;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"配置负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置负载均衡"}},[s._v("#")]),s._v(" 配置负载均衡")]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("upstream test.net{\n   ip_hash;\n   server 192.168.11.1:80;\n   server 192.168.11.11:80  down;\n   server 192.168.11.123:8009  max_fails=3  fail_timeout=20s;\n   server 192.168.11.1234:8080;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("upstream是Nginx的HTTP Upstream模块，这个模块通过一个简单的调度算法来实现客户端IP到后端服务器的负载均衡。\nNginx的负载均衡模块目前支持4种调度算法：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("轮询（默认）")]),s._v("。每个请求按时间顺序逐一分配到不同的后端服务器，如果后端某台服务器宕机，故障系统被自动剔除，使用户访问不受影响。Weight 指定轮询权值，Weight值越大，分配到的访问机率越高，主要用于后端每个服务器性能不均的情况下。")]),s._v(" "),a("li",[a("code",[s._v("ip_hash")]),s._v("。每个请求按访问IP的hash结果分配，这样来自同一个IP的访客固定访问一个后端服务器，有效解决了动态网页存在的session共享问题。")]),s._v(" "),a("li",[a("code",[s._v("fair")]),s._v("。这是比上面两个更加智能的负载均衡算法。此种算法可以依据页面大小和加载时间长短智能地进行负载均衡，也就是根据后端服务器的响应时间来分配请求，响应时间短的优先分配。Nginx本身是不支持fair的，如果需要使用这种调度算法，必须下载Nginx的upstream_fair模块。")]),s._v(" "),a("li",[a("code",[s._v("url_hash")]),s._v("。此方法按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，可以进一步提高后端缓存服务器的效率。Nginx本身是不支持url_hash的，如果需要使用这种调度算法，必须安装Nginx 的hash软件包。")])]),s._v(" "),a("p",[s._v("upstream可以设定每个后端服务器在负载均衡调度中的状态，支持的状态参数:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("down")]),s._v("，表示当前的server暂时不参与负载均衡")]),s._v(" "),a("li",[a("code",[s._v("backup")]),s._v("，预留的备份机器。当其他所有的非backup机器出现故障或者忙的时候，才会请求"),a("code",[s._v("backup")]),s._v("机器，因此这台机器的压力最轻。")]),s._v(" "),a("li",[a("code",[s._v("max_fails")]),s._v("，允许请求失败的次数，默认为"),a("code",[s._v("1")]),s._v("。当超过最大次数时，返回"),a("code",[s._v("proxy_next_upstream")]),s._v(" 模块定义的错误。")]),s._v(" "),a("li",[a("code",[s._v("fail_timeout")]),s._v("，在经历了"),a("code",[s._v("max_fails")]),s._v("次失败后，暂停服务的时间。"),a("code",[s._v("max_fails")]),s._v("可以和"),a("code",[s._v("fail_timeout")]),s._v("一起使用。")])]),s._v(" "),a("p",[a("strong",[s._v("注，当负载调度算法为ip_hash时，后端服务器在负载均衡调度中的状态不能是weight和backup。")])]),s._v(" "),a("h3",{attrs:{id:"设置页面缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置页面缓存"}},[s._v("#")]),s._v(" 设置页面缓存")]),s._v(" "),a("p",[s._v("页面缓存设置指令：")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("proxy_cache_path")]),s._v(": 指定缓存的路径和一些其他参数，缓存的数据存储在文件中，并且使用代理url的哈希值作为关键字与文件名。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("proxy_cache_path /data/nginx/cache/webserver levels=1:2 keys_zone=webserver:20mmax_size=1g;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("levels")]),s._v("参数指定缓存的子目录数。"),a("code",[s._v("keys_zone")]),s._v("指定活动的key和元数据存储在共享池（webserver为共享池名称，20m位共享池大小），"),a("code",[s._v("inactive")]),s._v("参数指定的时间内缓存的数据没有被请求则被删除，默认inactive为10分钟"),a("code",[s._v("·max_size")]),s._v("指定缓存空间的大小。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("proxy_cache")]),s._v(": 设置一个缓存区域的名称，一个相同的区域可以在不同的地方使用。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("proxy_cache_valid")]),s._v(": 为不同的应答设置不同的缓存时间。")])])]),s._v(" "),a("h3",{attrs:{id:"设置读写分离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置读写分离"}},[s._v("#")]),s._v(" 设置读写分离")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('server {\n        listen       80;\n        server_name  localhost;\n        #charset koi8-r;\n        #access_log  logs/host.access.log  main;\n        location / {\n                proxy_pass http://192.128.133.202;\n                if ($request_method = "PUT"){\n                        proxy_pass http://192.128.18.201;\n                }\n        }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"nginx-优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-优化"}},[s._v("#")]),s._v(" Nginx 优化")]),s._v(" "),a("p",[s._v("###全局块与events块")]),s._v(" "),a("p",[s._v("Nginx不同与apache服务器，当进行大量优化之后回呈现出明显的性能提升效果，Nginx在安装完毕之后，大部分参数已经是最优化了，需要配置管理并不多。")]),s._v(" "),a("p",[a("code",[s._v("worker_processes 4;")]),s._v("：建议值<=cpu核心数量，一般高于cpu数量不会带来好处，也许还有进程切换开销的负面影响，小于核心数量，还能空闲出一些cpu核心去处理系统方面的工作。")]),s._v(" "),a("p",[a("code",[s._v("worker_cpu_affinity 0001 0010 0100 1000")]),s._v("：将"),a("code",[s._v("work_process")]),s._v("绑定到特定的cpu上，避免进程在cpu之间切换的开销，例如8内核4进程时的设置方法：00000001 00000010 00000100 10000000")]),s._v(" "),a("p",[a("code",[s._v("worker_rlimit_nofile 655350")]),s._v("：每个进程最大可打开的文件描述符数量（linux上文件描述符比较广义，网络端口、设备、磁盘文件都是），文件描述符使用完后，新的连接就会被拒绝，产生502错误，linux最大可打开文件数可自行百度设置，理论值 ：系统最大数量/进程数，但是进程工作数不是平均分配的，所以可以设置大一些，其实越大愈好。")]),s._v(" "),a("p",[a("code",[s._v("worker_connections 200000")]),s._v("：并发响应能力的关键配置值，每个进程允许的最大同时连接数，最大的用户连接数：worker_connections*worker_processes = maxConnections;注意 maxConnections大等同于可响应的用户数量，因为一般一个浏览器回同时开两个连接，如果反向代理，nginx到后端服务器的连接也会占用连接数，因此，做静态服务器时，一般maxClient = work_connections * work_processes / 2,做反向代理服务器时，maxClient = work_connections * worker_processes / 4, 这个值理论上越大愈好，但是最多可承受多少请求与配件和网络相关。")]),s._v(" "),a("p",[s._v("备注：要达到超高负载下最好的网路响应能力，还有必要优化与网络相关的linux内核参数")]),s._v(" "),a("p",[s._v("###http模块")]),s._v(" "),a("p",[a("code",[s._v("access_log off")]),s._v("：日志相关，关闭此项可减少IO开销，但是也无法记录访问信息，不利业务分析，一般运维情况不建议关闭")]),s._v(" "),a("p",[a("code",[s._v("error_log logs/error.log crit")]),s._v("：错误日志相关，也会有IO开销，也可设置关闭，或者想这样设置错误日志级别，只有发现严重级别的错误才会记录错误日志信息")]),s._v(" "),a("p",[a("code",[s._v("sendfile on")]),s._v("： 启用内核复制模式，默认开启，简单来说就是一个磁盘文件通过Nginx在网络上发送出去，普通模式下，会从磁盘上读取到内存中，内存上有系统级内存、用户级内存、网络级内存，在这些内存中经过一系列的复制才会发送出去，会造成一部分的系统开销，如果开启这一项，从最底层的磁盘级IO复制到了网络级IO，不经过用户层次，减少了几次复制过程，加大了响应速度，正常开启此项即可。")]),s._v(" "),a("p",[a("code",[s._v("keepalive_timeout 30s")]),s._v("：设置连接超时时间，在http1.0版本中在访问网页时，每次发起请求，获取响应之后连接就会关闭，一个网页打开之后后续还有一些样式脚本等等一起组成网页，这里每次都会创立一个连接，都会是一个性能开销，所以这种方式整体的响应不是很高，http1.1做了改进，当打开一个连接之后还可以让这个连接存活一段时间，这段时间在有新的后续的请求可以复用这个连接，这样就是支持持久连接alive，这个值也不宜过长，长了闲置的连接会消耗最大连接数，降低每个连接的alive时间可在一定程度上提高可响应连接数量，所以一般可适当降低此值。一般设置成能够完成一个网页页面加载完成的时间即可。")]),s._v(" "),a("p",[a("code",[s._v("gzip on")]),s._v("：启动内容压缩，有效降低网络流量，默认是关闭的，生产环境应该打开，作用将响应的数据进行压缩，减少字节量，提高网络使用效率，")]),s._v(" "),a("p",[a("code",[s._v("gzip_min_length 1000")]),s._v("：设置启用压缩的最小长度，只有长度超过指定的值才压缩，过小的压缩达不到好的效果，还浪费系统资源，是不值得的")]),s._v(" "),a("p",[a("code",[s._v("gzip_comp_level 4")]),s._v("：设置压缩的级别，可选值1～9，压缩级别越高压缩率越高，但是对系统性能要求也越高，所以需要更新系统配置决定")]),s._v(" "),a("p",[a("code",[s._v("gzip_types text/plain text/css applicaion/json application/x-javascript text/xml")]),s._v("：对压缩类别进行设定，压缩效果不好的内容就不压缩了，节约系统资源")]),s._v(" "),a("p",[a("code",[s._v("open_file_cache max=655350 inactive=20s;")]),s._v("：静态文件缓存，最大缓存数量，文件未使用存活期，默认是没打开的，需要通过配置打开，对于经常访问的静态文件放在内存中，减少大量IO，提升性能，max指内存中最大能存放多少文件，inactive指 内存中文件的存活期，用缓存存放是有数量限制的，超过这个数量时会采用一定算法（如下）删除不常用的，加入一些常用的，提高缓存命中率。")]),s._v(" "),a("p",[a("code",[s._v("opne_file_cache_min_uses 2")]),s._v("：有效期内文件最少使用数，一定算法在这指的是：当一个文件被加载到缓存中后，在单位时间（上面设置的inactive=20s）内，达到了最少使用数，才算是一个命中率有效的文件，如果达不到说明文件可以被释放")]),s._v(" "),a("p",[a("code",[s._v("open_file_cache_valid 30s")]),s._v("：验证缓存有效时间间隔，这个就是设置上面的算法多长时间进行一次验证")]),s._v(" "),a("blockquote",[a("p",[s._v("Nginx相关地址")]),s._v(" "),a("p",[s._v("源码：https://trac.nginx.org/nginx/browser")]),s._v(" "),a("p",[s._v("官网：http://www.nginx.org/")])])])}),[],!1,null,null,null);n.default=t.exports}}]);